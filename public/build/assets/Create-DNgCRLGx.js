import{d as H,C as O,r as S,c as b,g as v,o as i,w as o,e as t,b as a,u as e,a as u,h as f,f as c,t as d,n as w,P as j,j as T,F as C,i as $}from"./app-De5aCyOy.js";import{_ as R}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Dj8HCjtT.js";import{_ as M,a as U,b as B,c as z,d as A}from"./SelectValue.vue_vue_type_script_setup_true_lang-D84q5NJt.js";import{_ as P}from"./Card.vue_vue_type_script_setup_true_lang-D592-r3Y.js";import{_ as I}from"./CardContent.vue_vue_type_script_setup_true_lang-BnfRKYb9.js";import{_ as q}from"./Checkbox.vue_vue_type_script_setup_true_lang-CJs0Ik0y.js";import{_ as p}from"./Button.vue_vue_type_script_setup_true_lang-C1ptny9S.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-BhPM2rb2.js";import{_ as G,a as J,b as K,c as Q}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DykgtCUG.js";import{_ as W}from"./DialogDescription.vue_vue_type_script_setup_true_lang-CQOeOJ-N.js";import{_ as X,a as Y}from"./index-Bl7hX8X-.js";import{_ as Z}from"./Progress.vue_vue_type_script_setup_true_lang-XKk6VJsB.js";import{_ as ee}from"./_plugin-vue_export-helper-DsuA5ZjC.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-DrTEAkGA.js";import"./index-D3npKzxP.js";import"./index-shR_F4Lk.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-UOeKMcHs.js";import"./clock-BXDw5ZYb.js";import"./useForwardPropsEmits-Cp6q3zLn.js";import"./Presence-DbAr2sRl.js";import"./ConfigProvider-B6_1veax.js";import"./useForwardExpose-Cyi8rQxf.js";import"./Teleport-swefm16Y.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./chevron-up-CPyPlHCY.js";import"./Collection-BDp_B7Ge.js";import"./usePrimitiveElement-B41iOtr7.js";import"./check-DTkWFW74.js";import"./useSize-CHi05SbU.js";import"./ohash.D__AXeF1-DHF4M4F_.js";import"./nullish-CHIgUVhi.js";import"./VisuallyHidden-9kO_gd9f.js";const se={class:"px-4 sm:px-0"},te={key:0},re={key:1},le={key:2},oe={class:"space-y-6 py-4"},ae={class:"relative w-32 h-32 mx-auto"},ne={class:"w-32 h-32 transform -rotate-90",viewBox:"0 0 36 36"},ie=["stroke-dasharray"],ue={class:"absolute inset-0 flex items-center justify-center"},de={class:"text-2xl font-bold text-foreground"},ce={class:"flex justify-center"},me={key:0,class:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center"},fe={key:1,class:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center animate-pulse"},pe={key:2,class:"w-12 h-12 bg-destructive/10 rounded-full flex items-center justify-center"},_e={class:"bg-muted rounded-lg p-4"},ve={class:"flex justify-between text-sm text-muted-foreground mb-2"},ge={class:"flex gap-3 justify-center"},xe={key:0,class:"text-xs text-muted-foreground text-center"},he={class:"space-y-3"},ke={key:0,class:"text-destructive text-sm"},ye={class:"space-y-3"},be={class:"space-y-3"},we={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-80 overflow-y-auto"},Ce={class:"text-sm font-medium text-foreground block truncate"},$e={class:"text-xs text-muted-foreground block truncate"},Ae={key:0,class:"text-destructive text-sm"},Ve={class:"flex justify-between items-center"},Se={class:"text-sm text-muted-foreground"},je={class:"font-medium"},Me={class:"flex gap-2"},Ue={class:"flex flex-col sm:flex-row gap-4 pt-6 border-t"},Be={key:0,class:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24"},ze={key:1},Pe={key:2},Ie={key:3},De={key:4,class:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fe=H({__name:"Create",props:{courses:Array,users:Array,departments:Array},setup(x){const h=x,l=O({course_id:new URLSearchParams(window.location.search).get("course_id")||"",user_ids:[],course_availability_id:null}),r=S({isVisible:!1,current:0,total:0,status:"sending",message:""});b(()=>h.courses.find(m=>m.id==l.course_id));const k=b(()=>r.value.total===0?0:Math.round(r.value.current/r.value.total*100));function D(){r.value={isVisible:!0,current:0,total:l.user_ids.length,status:"sending",message:"Preparing to send emails..."};const m=setInterval(()=>{r.value.current<r.value.total&&r.value.status==="sending"&&(r.value.current++,r.value.message=`Sending email ${r.value.current} of ${r.value.total}...`)},3e3);l.post("/admin/assignments",{onSuccess:s=>{clearInterval(m),r.value.status="success",r.value.message="All course assignments sent successfully!",r.value.current=r.value.total,setTimeout(()=>{r.value.isVisible=!1},4e3)},onError:s=>{clearInterval(m),r.value.status="error",r.value.message="Some assignments failed to send. Please check the logs."},onFinish:()=>{clearInterval(m)}})}function y(){r.value.isVisible=!1}function F(){l.user_ids=V.value.map(m=>m.id)}function N(){l.user_ids=[]}const _=S("all"),V=b(()=>!_.value||_.value==="all"?h.users:h.users.filter(m=>{var s;return((s=m.department_id)==null?void 0:s.toString())===_.value}));return(m,s)=>(i(),v(R,null,{default:o(()=>[t("div",se,[s[23]||(s[23]=t("div",{class:"mb-6"},[t("h1",{class:"text-xl sm:text-3xl font-bold text-foreground mb-2"},"Assign Course to Users"),t("p",{class:"text-muted-foreground"},"Select a course and users to send course assignment notifications with login credentials.")],-1)),a(e(G),{open:r.value.isVisible,"onUpdate:open":s[1]||(s[1]=n=>r.value.isVisible=n)},{default:o(()=>[a(e(J),{class:"sm:max-w-md",onInteractOutside:s[0]||(s[0]=n=>r.value.status!=="sending"?y():null)},{default:o(()=>[a(e(K),null,{default:o(()=>[a(e(Q),null,{default:o(()=>[r.value.status==="sending"?(i(),u("span",te,"Sending Course Assignments")):r.value.status==="success"?(i(),u("span",re,"Assignment Complete!")):r.value.status==="error"?(i(),u("span",le,"Assignment Failed")):f("",!0)]),_:1}),a(e(W),null,{default:o(()=>[c(d(r.value.message),1)]),_:1})]),_:1}),t("div",oe,[t("div",ae,[(i(),u("svg",ne,[s[4]||(s[4]=t("path",{class:"text-muted",fill:"none",stroke:"currentColor","stroke-width":"2",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),t("path",{class:w({"text-primary":r.value.status==="sending","text-green-500":r.value.status==="success","text-destructive":r.value.status==="error"}),fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-dasharray":`${k.value}, 100`,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",style:{transition:"stroke-dasharray 0.3s ease-in-out"}},null,10,ie)])),t("div",ue,[t("span",de,d(k.value)+"%",1)])]),t("div",ce,[r.value.status==="sending"?(i(),u("div",me,s[5]||(s[5]=[t("svg",{class:"animate-spin h-6 w-6 text-primary",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):r.value.status==="success"?(i(),u("div",fe,s[6]||(s[6]=[t("svg",{class:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):r.value.status==="error"?(i(),u("div",pe,s[7]||(s[7]=[t("svg",{class:"w-8 h-8 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):f("",!0)]),t("div",_e,[t("div",ve,[s[8]||(s[8]=t("span",null,"Progress",-1)),t("span",null,d(r.value.current)+" / "+d(r.value.total),1)]),a(e(Z),{value:k.value,class:"h-2"},null,8,["value"])]),t("div",ge,[r.value.status!=="sending"?(i(),v(e(p),{key:0,onClick:y,variant:"secondary"},{default:o(()=>s[9]||(s[9]=[c(" Close ")])),_:1})):f("",!0),r.value.status==="success"?(i(),v(e(p),{key:1,as:e(j),href:"/admin/assignments",onClick:y},{default:o(()=>s[10]||(s[10]=[c(" View Assignments ")])),_:1},8,["as"])):f("",!0)]),r.value.status==="sending"?(i(),u("p",xe," Please wait while we send the assignment emails... ")):f("",!0)])]),_:1})]),_:1},8,["open"]),a(e(P),null,{default:o(()=>[a(e(I),{class:"p-6 sm:p-8"},{default:o(()=>[t("form",{onSubmit:T(D,["prevent"]),class:"max-w-4xl space-y-8"},[t("div",he,[a(e(g),{for:"course-select",class:"text-sm font-semibold"},{default:o(()=>s[11]||(s[11]=[c("Select Course *")])),_:1}),a(e(M),{modelValue:e(l).course_id,"onUpdate:modelValue":s[2]||(s[2]=n=>e(l).course_id=n),disabled:e(l).processing},{default:o(()=>[a(e(U),{id:"course-select"},{default:o(()=>[a(e(B),{placeholder:"Choose a course to assign..."})]),_:1}),a(e(z),null,{default:o(()=>[(i(!0),u(C,null,$(x.courses,n=>(i(),v(e(A),{key:n.id,value:n.id.toString()},{default:o(()=>[c(d(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),e(l).errors.course_id?(i(),u("div",ke,d(e(l).errors.course_id),1)):f("",!0)]),t("div",ye,[a(e(g),null,{default:o(()=>s[12]||(s[12]=[c("Filter by Department (Optional)")])),_:1}),a(e(M),{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=n=>_.value=n)},{default:o(()=>[a(e(U),null,{default:o(()=>[a(e(B),{placeholder:"All Departments"})]),_:1}),a(e(z),null,{default:o(()=>[a(e(A),{value:"all"},{default:o(()=>s[13]||(s[13]=[c("All Departments")])),_:1}),(i(!0),u(C,null,$(x.departments,n=>(i(),v(e(A),{key:n.id,value:n.id.toString()},{default:o(()=>[c(d(n.name)+" ("+d(n.users_count)+" users) ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),t("div",be,[a(e(g),{class:"text-sm font-semibold"},{default:o(()=>s[14]||(s[14]=[c("Select Users *")])),_:1}),a(e(P),{class:"bg-muted/50"},{default:o(()=>[a(e(I),{class:"p-4"},{default:o(()=>[t("div",we,[(i(!0),u(C,null,$(V.value,n=>(i(),u("div",{key:n.id,class:w(["flex items-center space-x-3 p-3 bg-background rounded-lg border hover:border-primary/50 hover:bg-accent/50 transition-colors cursor-pointer",{"border-primary bg-accent":e(l).user_ids.includes(n.id)}])},[a(e(q),{id:`user-${n.id}`,checked:e(l).user_ids.includes(n.id),"onUpdate:checked":L=>{L?e(l).user_ids.push(n.id):e(l).user_ids=e(l).user_ids.filter(E=>E!==n.id)},disabled:e(l).processing},null,8,["id","checked","onUpdate:checked","disabled"]),a(e(g),{for:`user-${n.id}`,class:"min-w-0 flex-1 cursor-pointer"},{default:o(()=>[t("span",Ce,d(n.name),1),t("span",$e,d(n.email),1)]),_:2},1032,["for"])],2))),128))])]),_:1})]),_:1}),e(l).errors.user_ids?(i(),u("div",Ae,d(e(l).errors.user_ids),1)):f("",!0),t("div",Ve,[t("p",Se,[t("span",je,d(e(l).user_ids.length),1),c(" user"+d(e(l).user_ids.length!==1?"s":"")+" selected ",1)]),t("div",Me,[a(e(p),{type:"button",onClick:F,variant:"link",size:"sm",disabled:e(l).processing,class:"h-auto p-0 text-xs"},{default:o(()=>s[15]||(s[15]=[c(" Select All ")])),_:1},8,["disabled"]),s[17]||(s[17]=t("span",{class:"text-muted-foreground"},"|",-1)),a(e(p),{type:"button",onClick:N,variant:"link",size:"sm",disabled:e(l).processing,class:"h-auto p-0 text-xs text-muted-foreground hover:text-foreground"},{default:o(()=>s[16]||(s[16]=[c(" Clear All ")])),_:1},8,["disabled"])])])]),a(e(X),null,{default:o(()=>[s[19]||(s[19]=t("svg",{class:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),a(e(Y),null,{default:o(()=>s[18]||(s[18]=[t("strong",null,"Assignment Information:",-1),c(" Selected users will receive an email with course details and login credentials. New passwords will be automatically generated and sent to each user. Users can accept or decline the course assignment from their email. Email sending may take a few moments due to rate limiting. ")])),_:1})]),_:1}),t("div",Ue,[a(e(p),{type:"submit",class:"flex-1 sm:flex-none",disabled:e(l).processing||e(l).user_ids.length===0},{default:o(()=>[e(l).processing?(i(),u("svg",Be,s[20]||(s[20]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):f("",!0),e(l).processing?(i(),u("span",ze,"Sending Assignments...")):e(l).user_ids.length===0?(i(),u("span",Pe,"Select Users to Continue")):(i(),u("span",Ie," Assign Course to "+d(e(l).user_ids.length)+" User"+d(e(l).user_ids.length!==1?"s":""),1)),!e(l).processing&&e(l).user_ids.length>0?(i(),u("svg",De,s[21]||(s[21]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)]))):f("",!0)]),_:1},8,["disabled"]),a(e(p),{as:e(j),href:"/admin/assignments",variant:"secondary",class:w(["flex-1 sm:flex-none",{"pointer-events-none opacity-50":e(l).processing}])},{default:o(()=>s[22]||(s[22]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),c(" Back to Assignments ")])),_:1},8,["as","class"])])],32)]),_:1})]),_:1})])]),_:1}))}}),vs=ee(Fe,[["__scopeId","data-v-54ab8d57"]]);export{vs as default};
