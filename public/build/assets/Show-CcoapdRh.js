import{d as Ae,r as m,c as h,B as q,p as G,a as y,o as d,b as o,u as t,m as Se,w as r,e as a,P as Me,f as p,h as b,t as c,g as C,F as W,i as $e,bU as J}from"./app-De5aCyOy.js";import{V,f as Le}from"./AppLayout.vue_vue_type_script_setup_true_lang-DrTEAkGA.js";import{c as Ee,_ as x}from"./Button.vue_vue_type_script_setup_true_lang-C1ptny9S.js";import{_ as Q}from"./Card.vue_vue_type_script_setup_true_lang-D592-r3Y.js";import{_ as Y}from"./CardContent.vue_vue_type_script_setup_true_lang-BnfRKYb9.js";import{_ as Be}from"./CardDescription.vue_vue_type_script_setup_true_lang-7y99tksC.js";import{_ as De}from"./CardHeader.vue_vue_type_script_setup_true_lang-B9pSfhlq.js";import{_ as Z}from"./CardTitle.vue_vue_type_script_setup_true_lang-C3o6pLjC.js";import{_ as Re}from"./index-CNloWqrH.js";import{_ as ee}from"./Slider.vue_vue_type_script_setup_true_lang-CMlsLols.js";import{_ as Ve}from"./Progress.vue_vue_type_script_setup_true_lang-XKk6VJsB.js";import{_ as Ne,a as je}from"./index-Bl7hX8X-.js";import{A as Fe}from"./arrow-left-kG5YrchA.js";import{R as M}from"./refresh-cw-BJXsbrVc.js";import{B as Ie}from"./book-open-pPANAQ7D.js";import{C as Ue}from"./clock-BXDw5ZYb.js";import{R as ze}from"./rotate-ccw-D8-XKrTw.js";import{C as ae}from"./circle-check-big-BYC-wlwA.js";import{T as He}from"./triangle-alert-QBZ4KeJk.js";import{E as Ke}from"./external-link-Blg3pbjp.js";import{S as Oe,V as Xe}from"./volume-x-XXPuHanf.js";import{P as qe}from"./play-CqouLqeA.js";import{P as Ge}from"./pause-AuKBvP_D.js";import{S as We}from"./skip-forward-ChvwhDlf.js";import{_ as Je}from"./_plugin-vue_export-helper-DsuA5ZjC.js";import"./index-D3npKzxP.js";import"./index-shR_F4Lk.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-UOeKMcHs.js";import"./useForwardPropsEmits-Cp6q3zLn.js";import"./useSize-CHi05SbU.js";import"./useForwardExpose-Cyi8rQxf.js";import"./Collection-BDp_B7Ge.js";import"./ConfigProvider-B6_1veax.js";import"./usePrimitiveElement-B41iOtr7.js";import"./VisuallyHidden-9kO_gd9f.js";import"./VisuallyHiddenInput-CPW02NT0.js";import"./nullish-CHIgUVhi.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=Ee("HeadphonesIcon",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]),Ye={class:"max-w-4xl mx-auto space-y-6"},Ze={class:"flex flex-col md:flex-row gap-6"},ea={class:"w-full md:w-64 aspect-video bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg overflow-hidden shrink-0 relative"},aa=["src","alt"],sa={key:1,class:"w-full h-full flex items-center justify-center"},ta={key:2,class:"absolute inset-0 bg-black/20 flex items-center justify-center"},oa={class:"bg-white/90 rounded-full p-3"},la={class:"flex-1 space-y-4"},ra={key:0,class:"flex items-center gap-2 mb-2"},ua={class:"flex flex-wrap items-center gap-4"},na={class:"flex items-center gap-2 text-sm text-muted-foreground"},ia={class:"flex items-center gap-2 text-sm text-blue-600"},da={class:"flex items-center gap-2 text-sm text-purple-600"},ca={key:0,class:"flex items-center gap-2 text-sm text-green-600"},ma={class:"space-y-2"},fa={class:"flex justify-between items-center text-sm"},va={class:"font-medium"},pa={class:"flex justify-between text-xs text-muted-foreground"},ga={key:0,class:"ml-2 flex items-center gap-2 text-sm text-muted-foreground"},_a=["src"],ha={class:"space-y-3"},ya={class:"flex gap-2"},ka=["href"],ba={key:1,class:"text-center py-8"},xa={class:"flex items-center justify-center gap-2 text-muted-foreground mb-4"},wa={key:2,class:"space-y-6"},Ca={class:"flex items-center justify-center gap-4"},Ta={class:"space-y-2"},Pa={class:"flex justify-between text-sm text-muted-foreground"},Aa={class:"flex justify-between text-xs text-muted-foreground"},Sa={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},Ma={class:"flex items-center gap-3 min-w-[200px]"},$a={class:"text-xs text-muted-foreground min-w-[3ch] font-medium"},La={class:"flex items-center gap-2"},Ea={class:"flex gap-1"},Ba=Ae({__name:"Show",props:{audio:{},user_progress:{}},setup(se){var O;const u=se,te=(O=document.querySelector('meta[name="csrf-token"]'))==null?void 0:O.getAttribute("content"),oe=[{name:"Home",href:"/dashboard"},{name:"Audio Courses",href:"/audio"},{name:u.audio.name,href:`/audio/${u.audio.id}`}],l=m(),w=m(!1),i=m(u.user_progress.current_time||0),g=m(u.audio.duration||0),k=m(1),A=m(!1),$=m(1),T=m(!0),f=m(""),v=m(!1),_=m(!1),le=h(()=>Math.floor(i.value)),N=m(!1),re=h(()=>u.audio.storage_type==="local"?`/audio/${u.audio.id}/stream`:u.audio.google_cloud_url),L=m(i.value),E=m(),S=m(),ue=[.5,.75,1,1.25,1.5,1.75,2],j=h(()=>g.value>0?i.value/g.value*100:0),ne=h(()=>F(i.value)),ie=h(()=>F(g.value)),de=h(()=>j.value>=95||i.value>=g.value-30),ce=h(()=>Math.min(j.value,100)),me=h(()=>[i.value]),fe=h(()=>[k.value]),B=h(()=>{const e=le.value,s=Math.floor(e/60),n=e%60;return s>0?n>0?`${s}m ${n}s listened`:`${s}m listened`:n>0?`${n}s listened`:"0m listened"});function F(e){if(!e||isNaN(e))return"00:00";const s=Math.floor(e/60),n=Math.floor(e%60);return`${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function ve(){N.value=!0}function I(){!l.value||!_.value||(w.value?l.value.pause():(v.value=!0,l.value.play().catch(e=>{console.error("Play failed:",e),f.value="Unable to play audio. The file might be restricted or your connection is slow.",v.value=!1})))}function D(e){!l.value||!_.value||(v.value=!0,l.value.currentTime=e,i.value=e,S.value&&clearTimeout(S.value),S.value=setTimeout(()=>{P()},1e3))}function U(){const e=Math.min(i.value+15,g.value);D(e)}function z(){const e=Math.max(i.value-15,0);D(e)}function H(){l.value&&(A.value=!A.value,l.value.muted=A.value)}function R(e){l.value&&(k.value=e[0],l.value.volume=k.value,k.value>0&&A.value&&(A.value=!1,l.value.muted=!1))}function pe(e){l.value&&($.value=e,l.value.playbackRate=e,w.value&&P())}async function P(){console.log("saveProgress called!",{currentTime:i.value,lastSavedTime:L.value,audioId:u.audio.id});try{const e=Math.abs(i.value-L.value);if(e>=1){const s=await J.post(`/audio/${u.audio.id}/progress`,{current_time:i.value,total_listened_time:u.user_progress.total_listened_time+e});console.log("Progress API response:",s.data),s.data.success&&s.data.progress&&(u.user_progress.current_time=s.data.progress.current_time,u.user_progress.completion_percentage=s.data.progress.completion_percentage,u.user_progress.is_completed=s.data.progress.is_completed,console.log("✅ Local progress updated:",{completion:u.user_progress.completion_percentage,is_completed:u.user_progress.is_completed}),L.value=i.value)}}catch(e){console.error("Failed to save progress:",e.response||e)}}async function K(){console.log("markCompleted called for audio ID:",u.audio.id);try{const e=await J.post(`/audio/${u.audio.id}/complete`,{},{headers:{"X-CSRF-TOKEN":te}});console.log("Complete API response:",e.data),e.data.success&&(console.log("Audio marked as completed successfully"),setTimeout(()=>{window.location.reload()},1e3))}catch(e){console.error("Failed to mark as completed:",e.response||e),e.value="Failed to mark as completed. Please try again."}}function ge(){l.value&&(f.value="",T.value=!0,_.value=!1,l.value.load())}function _e(){T.value=!0,v.value=!0,console.log("Audio loading started")}function he(){_.value=!0,v.value=!1,console.log("Audio can start playing")}function ye(){l.value&&(g.value=l.value.duration||u.audio.duration,i.value>0&&i.value<g.value&&(l.value.currentTime=i.value),T.value=!1,v.value=!1,_.value=!0,f.value="",console.log("Audio loaded successfully, duration:",g.value,"resume from:",i.value))}function ke(){l.value&&(i.value=l.value.currentTime,v.value=!1)}function be(){w.value=!0,v.value=!1}function xe(){w.value=!1,P()}function we(){w.value=!1,i.value=g.value,P(),u.user_progress.is_completed||K()}function Ce(){v.value=!0,console.log("Audio is buffering...")}function Te(){v.value=!1,w.value=!0}function Pe(e){var s;if(console.error("Audio loading error:",e),(s=l.value)!=null&&s.error){const n=l.value.error.code,X=l.value.error.message;switch(console.error("Audio error details:",{code:n,message:X}),n){case 1:f.value="Audio loading was aborted. Please try again.";break;case 2:f.value="Network error while loading audio. Check your connection and try again.";break;case 3:f.value="Audio file is corrupted or in an unsupported format.";break;case 4:f.value="Audio file format is not supported or file is not accessible.";break;default:f.value="Failed to load audio. The file might be private or moved."}}else u.audio.storage_type==="local"?f.value="Failed to load audio from local storage. Please contact support.":f.value="Failed to load audio from Google Drive. Please check if the file is publicly accessible.";T.value=!1,v.value=!1,_.value=!1}return q(()=>{l.value&&(l.value.volume=k.value,l.value.playbackRate=$.value,l.value.preload="metadata"),E.value=setInterval(()=>{w.value&&P()},6e5);const e=()=>{P()};window.addEventListener("beforeunload",e),G(()=>{E.value&&clearInterval(E.value),S.value&&clearTimeout(S.value),window.removeEventListener("beforeunload",e),P()})}),q(()=>{function e(s){const n=s.target;if(!(n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.contentEditable==="true"))switch(s.code){case"Space":s.preventDefault(),I();break;case"ArrowLeft":s.preventDefault(),z();break;case"ArrowRight":s.preventDefault(),U();break;case"KeyM":s.preventDefault(),H();break;case"ArrowUp":s.preventDefault(),R([Math.min(k.value+.1,1)]);break;case"ArrowDown":s.preventDefault(),R([Math.max(k.value-.1,0)]);break}}document.addEventListener("keydown",e),G(()=>{document.removeEventListener("keydown",e)})}),(e,s)=>(d(),y(W,null,[o(t(Se),{title:`${e.audio.name} - Audio Course`},null,8,["title"]),o(Le,{breadcrumbs:oe},{default:r(()=>[a("div",Ye,[o(t(x),{asChild:"",variant:"ghost",class:"mb-4"},{default:r(()=>[o(t(Me),{href:"/audio"},{default:r(()=>[o(t(Fe),{class:"h-4 w-4 mr-2"}),s[1]||(s[1]=p(" Back to Audio Courses "))]),_:1})]),_:1}),o(t(Q),null,{default:r(()=>[o(t(Y),{class:"p-6"},{default:r(()=>[a("div",Ze,[a("div",ea,[e.audio.thumbnail_url&&!N.value?(d(),y("img",{key:0,src:e.audio.thumbnail_url,alt:e.audio.name,class:"w-full h-full object-cover",onError:ve},null,40,aa)):(d(),y("div",sa,[o(t(V),{class:"h-16 w-16 text-blue-500"})])),v.value||T.value?(d(),y("div",ta,[a("div",oa,[o(t(M),{class:"h-8 w-8 text-blue-600 animate-spin"})])])):b("",!0)]),a("div",la,[a("div",null,[e.audio.category?(d(),y("div",ra,[o(t(Ie),{class:"h-4 w-4 text-muted-foreground"}),o(t(Re),{variant:"outline"},{default:r(()=>[p(c(e.audio.category.name),1)]),_:1})])):b("",!0),o(t(Z),{class:"text-2xl mb-2"},{default:r(()=>[p(c(e.audio.name),1)]),_:1}),o(t(Be),{class:"text-base"},{default:r(()=>[p(c(e.audio.description||"No description available"),1)]),_:1})]),a("div",ua,[a("div",na,[o(t(Ue),{class:"h-4 w-4"}),a("span",null,c(e.audio.formatted_duration),1)]),a("div",ia,[o(t(ze),{class:"h-4 w-4"}),a("span",null,c(Math.round(e.user_progress.completion_percentage))+"% Complete",1)]),a("div",da,[o(t(Qe),{class:"h-4 w-4"}),a("span",null,c(B.value),1)]),e.user_progress.is_completed?(d(),y("div",ca,[o(t(ae),{class:"h-4 w-4"}),s[2]||(s[2]=a("span",null,"Completed",-1))])):b("",!0)]),a("div",ma,[a("div",fa,[s[3]||(s[3]=a("span",{class:"text-muted-foreground"},"Overall Progress",-1)),a("span",va,c(Math.round(e.user_progress.completion_percentage))+"%",1)]),o(t(Ve),{value:e.user_progress.completion_percentage,class:"h-2"},null,8,["value"]),a("div",pa,[a("span",null,c(e.user_progress.formatted_current_time)+" / "+c(e.audio.formatted_duration),1),a("span",null,c(B.value),1)])])])])]),_:1})]),_:1}),o(t(Q),null,{default:r(()=>[o(t(De),null,{default:r(()=>[o(t(Z),{class:"flex items-center gap-2"},{default:r(()=>[o(t(V),{class:"h-5 w-5"}),s[5]||(s[5]=p(" Audio Player ")),v.value?(d(),y("div",ga,[o(t(M),{class:"h-4 w-4 animate-spin"}),s[4]||(s[4]=p(" Buffering... "))])):b("",!0)]),_:1})]),_:1}),o(t(Y),{class:"space-y-6"},{default:r(()=>[a("audio",{ref_key:"audioRef",ref:l,src:re.value,preload:"metadata",onLoadstart:_e,onCanplay:he,onLoadeddata:ye,onTimeupdate:ke,onPlay:be,onPause:xe,onEnded:we,onWaiting:Ce,onPlaying:Te,onError:Pe,crossorigin:"anonymous"},null,40,_a),f.value?(d(),C(t(Ne),{key:0,variant:"destructive"},{default:r(()=>[o(t(He),{class:"h-4 w-4"}),o(t(je),null,{default:r(()=>[a("div",ha,[a("p",null,c(f.value),1),a("div",ya,[o(t(x),{onClick:ge,size:"sm",variant:"outline"},{default:r(()=>[o(t(M),{class:"h-4 w-4 mr-2"}),s[6]||(s[6]=p(" Retry "))]),_:1}),e.audio.storage_type==="google_drive"?(d(),C(t(x),{key:0,asChild:"",size:"sm",variant:"outline"},{default:r(()=>[a("a",{href:e.audio.google_cloud_url,target:"_blank"},[o(t(Ke),{class:"h-4 w-4 mr-2"}),s[7]||(s[7]=p(" Open Direct Link "))],8,ka)]),_:1})):b("",!0)])])]),_:1})]),_:1})):b("",!0),T.value&&!f.value?(d(),y("div",ba,[a("div",xa,[o(t(M),{class:"h-5 w-5 animate-spin"}),s[8]||(s[8]=a("span",null,"Loading audio...",-1))]),s[9]||(s[9]=a("div",{class:"text-sm text-muted-foreground"}," This may take a moment for large files ",-1))])):b("",!0),!T.value&&!f.value?(d(),y("div",wa,[a("div",Ca,[o(t(x),{onClick:z,variant:"outline",size:"sm",disabled:!_.value},{default:r(()=>[o(t(Oe),{class:"h-4 w-4"})]),_:1},8,["disabled"]),o(t(x),{onClick:I,size:"lg",class:"h-14 w-14 rounded-full relative",disabled:!_.value},{default:r(()=>[v.value?(d(),C(t(M),{key:0,class:"h-6 w-6 animate-spin"})):w.value?(d(),C(t(Ge),{key:2,class:"h-6 w-6"})):(d(),C(t(qe),{key:1,class:"h-6 w-6 ml-0.5"}))]),_:1},8,["disabled"]),o(t(x),{onClick:U,variant:"outline",size:"sm",disabled:!_.value},{default:r(()=>[o(t(We),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),a("div",Ta,[a("div",Pa,[a("span",null,c(ne.value),1),a("span",null,c(ie.value),1)]),o(t(ee),{"model-value":me.value,max:g.value,step:1,"onUpdate:modelValue":s[0]||(s[0]=n=>D(n[0])),class:"w-full cursor-pointer audio-progress-slider",disabled:!_.value},null,8,["model-value","max","disabled"]),a("div",Aa,[a("span",null,c(Math.round(ce.value))+"% played",1),a("span",null,c(B.value),1)])]),a("div",Sa,[a("div",Ma,[o(t(x),{onClick:H,variant:"ghost",size:"sm",class:"shrink-0"},{default:r(()=>[!A.value&&k.value>0?(d(),C(t(V),{key:0,class:"h-4 w-4"})):(d(),C(t(Xe),{key:1,class:"h-4 w-4"}))]),_:1}),o(t(ee),{"model-value":fe.value,max:1,step:.01,"onUpdate:modelValue":R,class:"w-32 cursor-pointer audio-volume-slider"},null,8,["model-value"]),a("span",$a,c(Math.round(k.value*100))+"% ",1)]),a("div",La,[s[10]||(s[10]=a("span",{class:"text-sm text-muted-foreground"},"Speed:",-1)),a("div",Ea,[(d(),y(W,null,$e(ue,n=>o(t(x),{key:n,onClick:X=>pe(n),variant:$.value===n?"default":"outline",size:"sm",class:"text-xs px-2 py-1 h-auto"},{default:r(()=>[p(c(n)+"x ",1)]),_:2},1032,["onClick","variant"])),64))])]),de.value&&!e.user_progress.is_completed?(d(),C(t(x),{key:0,onClick:K,variant:"outline",size:"sm",class:"gap-2"},{default:r(()=>[o(t(ae),{class:"h-4 w-4"}),s[11]||(s[11]=p(" Mark Complete "))]),_:1})):b("",!0)]),s[12]||(s[12]=a("div",{class:"text-xs text-muted-foreground text-center space-y-1"},[a("div",{class:"font-medium"},"Keyboard Shortcuts:"),a("div",{class:"flex flex-wrap justify-center gap-x-4 gap-y-1"},[a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"Space"),p(" Play/Pause")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"←/→"),p(" Skip 15s")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"M"),p(" Mute")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"↑/↓"),p(" Volume")])])],-1))])):b("",!0)]),_:1})]),_:1})])]),_:1})],64))}}),_s=Je(Ba,[["__scopeId","data-v-74c88e96"]]);export{_s as default};
