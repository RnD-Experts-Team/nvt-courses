import{r as _,c as B,B as te,p as se,g as m,o as l,w as a,e as n,b as t,h as v,u as e,t as c,f as r,a as d,n as F,F as N,i as T,P as $,W as V}from"./app-De5aCyOy.js";import{_ as ae}from"./AttendanceLayout-BvbuXp_w.js";import{S as oe,_ as le,a as ne}from"./ClockInModal-W0tIq6aN.js";import{_ as k}from"./Button.vue_vue_type_script_setup_true_lang-C1ptny9S.js";import{_ as y}from"./Card.vue_vue_type_script_setup_true_lang-D592-r3Y.js";import{_ as w}from"./CardContent.vue_vue_type_script_setup_true_lang-BnfRKYb9.js";import{_ as ie}from"./CardDescription.vue_vue_type_script_setup_true_lang-7y99tksC.js";import{_ as z}from"./CardHeader.vue_vue_type_script_setup_true_lang-B9pSfhlq.js";import{_ as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-C3o6pLjC.js";import{_ as M}from"./index-CNloWqrH.js";import{_ as U}from"./Separator.vue_vue_type_script_setup_true_lang-DdEZmx_q.js";import{A as q}from"./activity-DLqIsvcX.js";import{C as E}from"./clock-BXDw5ZYb.js";import{B as R}from"./book-open-pPANAQ7D.js";import{T as re}from"./timer-Dxqjdf0U.js";import{L as ue}from"./loader-circle-DgBH8UyT.js";import{P as ce}from"./play-CqouLqeA.js";import{S as de}from"./star-BP7x_abV.js";import{C as W}from"./chevron-left-Ci-PwYhm.js";import{q as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-DrTEAkGA.js";import"./index-shR_F4Lk.js";import"./index-D3npKzxP.js";import"./_plugin-vue_export-helper-DsuA5ZjC.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-UOeKMcHs.js";const me={class:"flex h-full flex-1 flex-col gap-6 p-0 md:p-4"},fe={class:"grid auto-rows-min gap-6 md:grid-cols-2 max-w-5xl mx-auto w-full"},_e={class:"text-5xl md:text-6xl font-mono font-bold transition-all duration-300 transform hover:scale-105 mb-4"},ge={class:"flex items-center justify-center"},ve={key:0,class:"space-y-2 text-center"},ke={class:"text-sm text-muted-foreground"},he={key:0,class:"text-sm text-muted-foreground"},pe={class:"text-sm text-muted-foreground"},xe={class:"space-y-3"},ye={class:"grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"},we={class:"flex justify-between items-start"},Ce={class:"text-sm font-medium"},be={key:0,class:"text-sm text-muted-foreground"},Se={class:"flex items-center"},$e={class:"truncate"},De={class:"text-sm text-muted-foreground"},Pe={class:"flex items-center"},Le={key:0},Oe={key:1},Ie={key:1,class:"flex items-center gap-1"},je={class:"flex justify-center items-center gap-4"},Be={key:1},Fe={class:"text-sm text-muted-foreground"},Ne={key:1},nt={__name:"Clock",props:{clockings:{type:Object,required:!0,default:()=>({data:[],current_page:1,last_page:1,prev_page_url:null,next_page_url:null})},activeSession:{type:Object,default:null},userCourses:{type:Array,default:()=>[]}},setup(u){const D=u,C=_(!1),f=_(!1),h=_(!1),p=_(!1),P=_({rating:3,comment:""}),L=_(""),O=_("");let b=null;const g=B(()=>D.activeSession!==null),x=B(()=>D.activeSession||{});function I(){const o=new Date;L.value=o.toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit",second:"2-digit"}),O.value=o.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function H(o){return o?new Date(o).toLocaleString():"—"}function J(o){return o?new Date(o).toLocaleString("en-US",{hour12:!1,month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function S(o){if(!o||o<0)return"0 minutes";const s=Math.floor(o/60),i=Math.floor(o%60);return s>0?`${s}h ${i}m`:`${i}m`}function K(){p.value=!0}async function Q(o){try{f.value=!0,V.post("/clock-in",{course_id:o.course_id},{onSuccess:()=>{console.log("Clock in successful"),p.value=!1},onError:s=>{console.error("Clock in failed:",s),alert("Failed to clock in. Please try again.")},onFinish:()=>{f.value=!1}})}catch(s){console.error("Clock in exception:",s),f.value=!1}}function X(){h.value=!0,P.value={rating:null,comment:""}}async function Y(o){if(!o.rating){alert("Please provide a rating");return}try{f.value=!0,V.post("/clock-out",{rating:o.rating,comment:o.comment},{onSuccess:()=>{console.log("Clock out successful"),h.value=!1},onError:s=>{console.error("Clock out failed:",s),alert("Failed to clock out. Please try again.")},onFinish:()=>{f.value=!1}})}catch(s){console.error("Clock out exception:",s),f.value=!1}}const Z=o=>o?"default":"secondary";return te(()=>{I(),b=setInterval(I,1e3)}),se(()=>{b&&clearInterval(b)}),(o,s)=>(l(),m(ae,{title:"Attendance Clock"},{actions:a(()=>[t(e(k),{asChild:"",variant:"outline"},{default:a(()=>[t(e($),{href:"/attendance"},{default:a(()=>s[2]||(s[2]=[r(" View Records ")])),_:1})]),_:1})]),default:a(()=>[n("div",me,[n("div",fe,[t(e(y),{class:"transition-all duration-300 hover:shadow-md"},{default:a(()=>[t(e(w),{class:"flex flex-col items-center justify-center p-6"},{default:a(()=>[n("div",_e,c(L.value),1),t(e(ie),{class:"text-center text-base"},{default:a(()=>[r(c(O.value),1)]),_:1})]),_:1})]),_:1}),t(e(y),null,{default:a(()=>[t(e(z),null,{default:a(()=>[t(e(A),{class:"text-center flex items-center justify-center gap-2"},{default:a(()=>[t(e(q),{class:"h-5 w-5"}),s[3]||(s[3]=r(" Current Status "))]),_:1})]),_:1}),t(e(w),{class:"space-y-4"},{default:a(()=>[n("div",ge,[n("div",{class:F(["h-3 w-3 rounded-full mr-2",g.value?"bg-green-500 animate-pulse":"bg-muted-foreground"])},null,2),t(e(M),{variant:g.value?"default":"secondary",class:"font-medium"},{default:a(()=>[r(c(g.value?"Clocked In":"Clocked Out"),1)]),_:1},8,["variant"])]),g.value?(l(),d("div",ve,[n("div",ke,[t(e(E),{class:"h-4 w-4 inline mr-1"}),r(" Clocked in at: "+c(H(x.value.clock_in)),1)]),g.value&&x.value.course?(l(),d("div",he,[t(e(R),{class:"h-4 w-4 inline mr-1"}),r(" Course: "+c(x.value.course.name),1)])):v("",!0),n("div",pe,[t(e(re),{class:"h-4 w-4 inline mr-1"}),r(" Duration: "+c(S(x.value.current_duration||0)),1)])])):v("",!0),t(e(U)),n("div",xe,[g.value?(l(),m(e(k),{key:1,onClick:X,variant:"destructive",class:"w-full",size:"lg",disabled:C.value},{default:a(()=>[t(e(oe),{class:"mr-2 h-5 w-5"}),s[5]||(s[5]=r(" Clock Out "))]),_:1},8,["disabled"])):(l(),m(e(k),{key:0,onClick:K,class:"w-full",size:"lg",disabled:C.value},{default:a(()=>[C.value?(l(),m(e(ue),{key:0,class:"mr-2 h-5 w-5 animate-spin"})):(l(),m(e(ce),{key:1,class:"mr-2 h-5 w-5"})),s[4]||(s[4]=r(" Clock In "))]),_:1},8,["disabled"]))])]),_:1})]),_:1})]),u.clockings.data&&u.clockings.data.length>0?(l(),m(e(y),{key:0,class:"max-w-5xl mx-auto w-full"},{default:a(()=>[t(e(z),null,{default:a(()=>[t(e(A),{class:"flex items-center gap-2"},{default:a(()=>[t(e(q),{class:"h-5 w-5"}),s[6]||(s[6]=r(" Recent Activity "))]),_:1})]),_:1}),t(e(w),null,{default:a(()=>[n("div",ye,[(l(!0),d(N,null,T(u.clockings.data,(i,ee)=>(l(),m(e(y),{key:ee,class:"hover:shadow-md transition-shadow"},{default:a(()=>[t(e(w),{class:"p-4 space-y-3"},{default:a(()=>[n("div",we,[n("div",Ce,c(J(i.clock_in)),1),t(e(M),{variant:Z(i.clock_out),class:"text-xs"},{default:a(()=>[r(c(i.clock_out?"Completed":"In Progress"),1)]),_:2},1032,["variant"])]),i.course_name?(l(),d("div",be,[n("div",Se,[t(e(R),{class:"h-4 w-4 mr-1 shrink-0"}),n("span",$e,c(i.course_name),1)])])):v("",!0),n("div",De,[n("div",Pe,[t(e(E),{class:"h-4 w-4 mr-1 shrink-0"}),n("span",null,[i.clock_out?(l(),d("span",Le,c(S(i.duration_in_minutes)),1)):(l(),d("span",Oe,c(S(i.current_duration||0))+" (ongoing) ",1))])])]),i.rating?(l(),d("div",Ie,[(l(),d(N,null,T(5,j=>t(e(de),{key:j,class:F(["h-4 w-4",j<=i.rating?"text-yellow-400 fill-current":"text-muted-foreground"])},null,8,["class"])),64))])):v("",!0)]),_:2},1024)]),_:2},1024))),128))]),t(e(U),{class:"my-6"}),n("div",je,[t(e(k),{asChild:"",variant:"outline",size:"sm",disabled:!u.clockings.prev_page_url},{default:a(()=>[u.clockings.prev_page_url?(l(),m(e($),{key:0,href:u.clockings.prev_page_url},{default:a(()=>[t(e(W),{class:"h-4 w-4 mr-1"}),s[7]||(s[7]=r(" Previous "))]),_:1},8,["href"])):(l(),d("span",Be,[t(e(W),{class:"h-4 w-4 mr-1"}),s[8]||(s[8]=r(" Previous "))]))]),_:1},8,["disabled"]),n("span",Fe," Page "+c(u.clockings.current_page)+" of "+c(u.clockings.last_page),1),t(e(k),{asChild:"",variant:"outline",size:"sm",disabled:!u.clockings.next_page_url},{default:a(()=>[u.clockings.next_page_url?(l(),m(e($),{key:0,href:u.clockings.next_page_url},{default:a(()=>[s[9]||(s[9]=r(" Next ")),t(e(G),{class:"h-4 w-4 ml-1"})]),_:1},8,["href"])):(l(),d("span",Ne,[s[10]||(s[10]=r(" Next ")),t(e(G),{class:"h-4 w-4 ml-1"})]))]),_:1},8,["disabled"])])]),_:1})]),_:1})):v("",!0)]),t(le,{show:p.value,courses:u.userCourses,"is-submitting":f.value,onClose:s[0]||(s[0]=i=>p.value=!1),onSubmit:Q},null,8,["show","courses","is-submitting"]),t(ne,{show:h.value,"initial-form":P.value,"is-submitting":f.value,onClose:s[1]||(s[1]=i=>h.value=!1),onSubmit:Y},null,8,["show","initial-form","is-submitting"])]),_:1}))}};export{nt as default};
